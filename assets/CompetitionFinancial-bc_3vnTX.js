import{j as e,L as M,C as Z,c as G,P,a as B,b as H,e as T,d as q,p as J,r as F,R as Y}from"./main-zD1GOUsg.js";import{b as Q,i as U,c as W}from"./FinancialData-BI_1lOyY.js";Z.register(G,P,B,H,T,q,J);function X({graph_text:m,showData:b}){const N=Object.keys(b[0]).filter(d=>d!=="date"),y={labels:b.map(d=>d.date),datasets:N.map((d,g)=>({label:d,data:b.map(O=>O[d]??null),fill:!1,borderColor:["#f44336","#4caf50","#2196f3","#ff9800"][g%4],tension:.4,pointRadius:5,pointHoverRadius:7,spanGaps:!0}))},v={responsive:!0,maintainAspectRatio:!1,plugins:{title:{display:!1,text:m,font:{size:18}},tooltip:{callbacks:{label:function(d){const g=d.parsed.y;return`${d.dataset.label}: ${g==null?void 0:g.toLocaleString()}`}}}},scales:{y:{beginAtZero:!1,ticks:{callback:d=>d.toLocaleString()}}}};return e.jsx(M,{data:y,options:v})}function ne({data:m,stockCodes:b,competeDatas:N}){console.log(N);const[y,v]=F.useState({}),[d,g]=F.useState([]),[O,I]=F.useState({}),[_,R]=F.useState(null),z=a=>{R(s=>s===a?null:a)},A=(a,s)=>{v(l=>{const f=l[s]||[];if(f.length===0)return{...l,[s]:[{[a]:!0}]};const t=f.findIndex(w=>Object.keys(w)[0]===a);if(t!==-1){const w=[...f],n=Object.keys(w[t])[0],i=w[t][n];return w[t]={[n]:!i},{...l,[s]:w}}else return{...l,[s]:[...f,{[a]:!0}]}}),console.log(y)};return F.useEffect(()=>{if(!N||Object.keys(N).length===0)return;const a=b==null?void 0:b.split(" ").map(s=>s.trim());y&&Object.entries(y).forEach(([s,l])=>{l.forEach(f=>{var x,h,j;const t=Object.keys(f)[0];if(!f[t]){g(o=>{const p={...o};return delete p[t],p});return}const n=[],i=(x=m==null?void 0:m[s])==null?void 0:x.map(o=>o[t]),r=(h=m==null?void 0:m[s])==null?void 0:h.map(o=>o.asOfDate),u=(j=m==null?void 0:m.price)==null?void 0:j.longName;n.push({itemKey:t,name:u,value:i,date:r});let c=i.every(o=>o==null||o===""||isNaN(o));if(a.forEach(o=>{var $,E,C;const p=($=N[o])==null?void 0:$[s];if(!p)return;const k=p.map(S=>S[t]),V=p.map(S=>S.asOfDate),L=(C=(E=N[o])==null?void 0:E.price)==null?void 0:C.longName;if(n.push({itemKey:t,name:L,value:k,date:V}),k){const S=k.every(D=>D==null||D===""||isNaN(D));c=c&&S}}),c){alert(`${t} is not found for any company.`),v(o=>{const p={...o};return p[s]&&(p[s]=p[s].filter(k=>Object.keys(k)[0]!==t),p[s].length===0&&delete p[s]),p});return}g(o=>({...o,[t]:n}))})})},[y,Object.keys(N).length]),e.jsxs("div",{className:"financial_container",children:[e.jsx("div",{className:"financial_select",children:e.jsxs("ul",{children:[e.jsx("p",{className:"financial_title",children:"Balance Sheet"}),Object.entries(Q).map(([a,s],l)=>e.jsx("li",{className:l%2===0?"even-row":"odd-row",onClick:()=>A(s,"balance_sheet"),children:a.replace(/([a-z])([A-Z])/g,"$1 $2")},l)),e.jsx("p",{className:"financial_title",children:"Income Statement"}),Object.entries(U).map(([a,s],l)=>e.jsx("li",{className:l%2===0?"even-row":"odd-row",onClick:()=>A(s,"income_statement"),children:a.replace(/([a-z])([A-Z])/g,"$1 $2")},l)),e.jsx("p",{className:"financial_title",children:"Income Statement"}),Object.entries(W).map(([a,s],l)=>e.jsx("li",{className:l%2===0?"even-row":"odd-row",onClick:()=>A(s,"cash_flow"),children:a.replace(/([a-z])([A-Z])/g,"$1 $2")},l))]})}),d&&Object.keys(d).length>0?e.jsxs("div",{className:"financial-chart-table",children:[e.jsx("div",{className:"header-row",children:e.jsx("button",{className:"refresh-button",onClick:()=>{g({}),v({})},children:e.jsx("span",{className:"material-symbols-outlined",children:"refresh"})})}),e.jsx("div",{children:e.jsxs("table",{className:"financial-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Annualized Growth"}),(()=>{var l;const a=Object.keys(d)[0];return Array.from(new Set((l=d[a])==null?void 0:l.flatMap(f=>f.name))).map((f,t)=>e.jsx("th",{children:f},t))})()]})}),e.jsx("tbody",{children:Object.entries(d).map(([a,s])=>{const l=Array.from(new Set(s.flatMap(n=>n.name))),f=l.map(n=>{const i={name:n};return s.forEach(r=>{r.name===n&&r.date.forEach((u,c)=>{const x=r.value[c];i[new Date(u).getFullYear()]=x})}),i}),t=Array.from(new Set(s.flatMap(n=>n.date.map(i=>new Date(i).getFullYear())))).sort((n,i)=>n-i),w=t.map(n=>{const i={date:n};return s.forEach(r=>{const u=r.date.findIndex(c=>new Date(c).getFullYear()===n);i[r.name]=u!==-1?r.value[u]:null}),i});return e.jsxs(Y.Fragment,{children:[e.jsxs("tr",{onClick:()=>I(n=>({...n,[a]:!n[a]})),children:[e.jsx("td",{children:a.replace(/([a-z])([A-Z])/g,"$1 $2")}),f.map((n,i)=>{const r=Object.keys(n).filter(h=>h!=="name"),u=r.reduce((h,j)=>new Date(j)>new Date(h)?j:h),c=r.reduce((h,j)=>new Date(j)<new Date(h)?j:h),x=(()=>{const h=n[c],j=n[u],o=new Date(u).getFullYear()-new Date(c).getFullYear();return h&&j&&o>0?((Math.pow(j/h,1/o)-1)*100).toFixed(2):NaN})();return e.jsx("td",{children:isNaN(x)?"Not Valid":`${x}%`},i)})]}),O[a]&&e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:"no-border-chart",children:[e.jsx("td",{}),e.jsx("td",{colSpan:l.length+1,children:e.jsx("div",{className:"chart-container",children:e.jsx(X,{showData:w},a)})})]}),e.jsxs("tr",{className:"no-border-financial",children:[e.jsx("td",{}),e.jsx("td",{colSpan:l.length+1,children:e.jsxs("table",{className:"financial-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"(MYR/Million)"}),t.map(n=>e.jsx("th",{children:n},n))]})}),e.jsx("tbody",{children:f.map((n,i)=>e.jsxs(Y.Fragment,{children:[e.jsxs("tr",{onClick:()=>z(n.name),className:"clickable-row",children:[e.jsx("td",{children:n.name}),t.map((r,u)=>{const c=n[r]!==void 0?n[r]:null;return e.jsx("td",{children:c!=null?(c/1e6).toFixed(2):""},u)})]}),_===n.name&&e.jsxs("tr",{className:"yoy-growth-row",children:[e.jsx("td",{style:{fontSize:"0.8em",textAlign:"right"},children:"YoY Growth"}),e.jsx("td",{}),t.slice(1).map((r,u)=>{try{const c=n[r]!==void 0?n[r]:"N/A",x=t[u],h=n[x]!==void 0?n[x]:"N/A";if(isNaN(c)||isNaN(h)||h===0)throw new Error("Invalid data for growth calculation");const j=(c/h-1).toFixed(2);return e.jsx("td",{className:`yoy-growth-value ${j>=0?"positive":"negative"}`,style:{textAlign:"center"},children:j},u)}catch(c){return console.error(`Error calculating YoY growth for ${r}:`,c.message),e.jsx("td",{className:"yoy-growth-value"},u)}})]})]},i))})]})})]})]})]},a)})})]})})]}):e.jsx("div",{children:e.jsx("h4",{children:"No item was selected"})})]})}export{ne as default};
