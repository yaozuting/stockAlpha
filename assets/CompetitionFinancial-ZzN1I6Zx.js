import{j as e,L,C as Z,c as G,P,a as B,b as H,e as T,d as q,p as J,r as S,R as I}from"./main-BY9gO0Xd.js";import{b as Q,i as U,c as W}from"./FinancialData-DG-ktGNq.js";Z.register(G,P,B,H,T,q,J);function X({graph_text:x,showData:b}){const N=Object.keys(b[0]).filter(h=>h!=="date"),v={labels:b.map(h=>h.date),datasets:N.map((h,g)=>({label:h,data:b.map(F=>F[h]??null),fill:!1,borderColor:["#f44336","#4caf50","#2196f3","#ff9800"][g%4],tension:.4,pointRadius:5,pointHoverRadius:7,spanGaps:!0}))},k={responsive:!0,maintainAspectRatio:!1,plugins:{title:{display:!1,text:x,font:{size:18}},tooltip:{callbacks:{label:function(h){const g=h.parsed.y;return`${h.dataset.label}: ${g==null?void 0:g.toLocaleString()}`}}}},scales:{y:{beginAtZero:!1,ticks:{callback:h=>h.toLocaleString()}}}};return e.jsx(L,{data:v,options:k})}function ne({data:x,stockCodes:b,competeDatas:N}){console.log(N);const[v,k]=S.useState({}),[h,g]=S.useState([]),[F,_]=S.useState({}),[R,z]=S.useState(null),V=a=>{z(s=>s===a?null:a)},$=(a,s)=>{k(l=>{const m=l[s]||[];if(m.length===0)return{...l,[s]:[{[a]:!0}]};const c=m.findIndex(w=>Object.keys(w)[0]===a);if(c!==-1){const w=[...m],n=Object.keys(w[c])[0],o=w[c][n];return w[c]={[n]:!o},{...l,[s]:w}}else return{...l,[s]:[...m,{[a]:!0}]}}),console.log(v)};return S.useEffect(()=>{if(!N||Object.keys(N).length===0)return;const a=b==null?void 0:b.split(" ").map(s=>s.trim());v&&Object.entries(v).forEach(([s,l])=>{l.forEach(m=>{var d,r,f;const c=Object.keys(m)[0];if(!m[c]){g(t=>{const j={...t};return delete j[c],j});return}const n=[],o=(d=x==null?void 0:x[s])==null?void 0:d.map(t=>t[c]),u=(r=x==null?void 0:x[s])==null?void 0:r.map(t=>t.asOfDate),p=(f=x==null?void 0:x.price)==null?void 0:f.longName;n.push({itemKey:c,name:p,value:o,date:u});let i=o.every(t=>t==null||t===""||isNaN(t));if(a.forEach(t=>{var E,M,Y;const j=(E=N[t])==null?void 0:E[s];if(!j)return;const y=j.map(D=>D[c]),C=j.map(D=>D.asOfDate),O=(Y=(M=N[t])==null?void 0:M.price)==null?void 0:Y.longName;if(n.push({itemKey:c,name:O,value:y,date:C}),y){const D=y.every(A=>A==null||A===""||isNaN(A));i=i&&D}}),i){alert(`${c} is not found for any company.`),k(t=>{const j={...t};return j[s]&&(j[s]=j[s].filter(y=>Object.keys(y)[0]!==c),j[s].length===0&&delete j[s]),j});return}g(t=>({...t,[c]:n})),console.log(h)})})},[v,Object.keys(N).length]),e.jsxs("div",{className:"financial_container",children:[e.jsx("div",{className:"financial_select",children:e.jsxs("ul",{children:[e.jsx("p",{className:"financial_title",children:"Balance Sheet"}),Object.entries(Q).map(([a,s],l)=>e.jsx("li",{className:l%2===0?"even-row":"odd-row",onClick:()=>$(s,"balance_sheet"),children:a.replace(/([a-z])([A-Z])/g,"$1 $2")},l)),e.jsx("p",{className:"financial_title",children:"Income Statement"}),Object.entries(U).map(([a,s],l)=>e.jsx("li",{className:l%2===0?"even-row":"odd-row",onClick:()=>$(s,"income_statement"),children:a.replace(/([a-z])([A-Z])/g,"$1 $2")},l)),e.jsx("p",{className:"financial_title",children:"Income Statement"}),Object.entries(W).map(([a,s],l)=>e.jsx("li",{className:l%2===0?"even-row":"odd-row",onClick:()=>$(s,"cash_flow"),children:a.replace(/([a-z])([A-Z])/g,"$1 $2")},l))]})}),h&&Object.keys(h).length>0?e.jsxs("div",{className:"financial-chart-table",children:[e.jsx("div",{className:"header-row",children:e.jsx("button",{className:"refresh-button",onClick:()=>{g({}),k({})},children:e.jsx("span",{className:"material-symbols-outlined",children:"refresh"})})}),e.jsx("div",{children:e.jsxs("table",{className:"financial-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Annualized Growth"}),(()=>{var l;const a=Object.keys(h)[0];return Array.from(new Set((l=h[a])==null?void 0:l.flatMap(m=>m.name))).map((m,c)=>e.jsx("th",{children:m},c))})()]})}),e.jsx("tbody",{children:Object.entries(h).map(([a,s])=>{const l=Array.from(new Set(s.flatMap(n=>n.name))),m=l.map(n=>{const o={name:n},u=s.filter(d=>d.name===n),i=u.flatMap(d=>d.date.map(r=>new Date(r))).map(d=>`${d.getMonth()}-${d.getDate()}`);return u.forEach(d=>{d.date.forEach((r,f)=>{const t=new Date(r),j=t.getFullYear(),y=`${t.getMonth()}-${t.getDate()}`;i.filter(O=>O===y).length>1?o[j]=d.value[f]:o[j]||(o[j]=d.value[f])})}),o}),c=Array.from(new Set(s.flatMap(n=>n.date.map(o=>new Date(o).getFullYear())))).sort((n,o)=>n-o),w=c.map(n=>{const o={date:n};return s.forEach(u=>{const p=u.date.findIndex(i=>new Date(i).getFullYear()===n);o[u.name]=p!==-1?u.value[p]:null}),o});return e.jsxs(I.Fragment,{children:[e.jsxs("tr",{onClick:()=>_(n=>({...n,[a]:!n[a]})),children:[e.jsx("td",{children:a.replace(/([a-z])([A-Z])/g,"$1 $2")}),m.map((n,o)=>{const u=Object.keys(n).filter(r=>r!=="name"),p=u.reduce((r,f)=>new Date(f)>new Date(r)?f:r),i=u.reduce((r,f)=>new Date(f)<new Date(r)?f:r),d=(()=>{const r=n[i],f=n[p],t=new Date(p).getFullYear()-new Date(i).getFullYear();return r&&f&&t>0?((Math.pow(f/r,1/t)-1)*100).toFixed(2):NaN})();return e.jsx("td",{children:isNaN(d)?"Not Valid":`${d}%`},o)})]}),F[a]&&e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:"no-border-chart",children:[e.jsx("td",{}),e.jsx("td",{colSpan:l.length+1,children:e.jsx("div",{className:"chart-container",children:e.jsx(X,{showData:w},a)})})]}),e.jsxs("tr",{className:"no-border-financial",children:[e.jsx("td",{}),e.jsx("td",{colSpan:l.length+1,children:e.jsxs("table",{className:"financial-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"(MYR/Million)"}),c.map(n=>e.jsx("th",{children:n},n))]})}),e.jsx("tbody",{children:m.map((n,o)=>e.jsxs(I.Fragment,{children:[e.jsxs("tr",{onClick:()=>V(n.name),className:"clickable-row",children:[e.jsx("td",{children:n.name}),c.map((u,p)=>{const i=n[u]!==void 0?n[u]:null;return e.jsx("td",{children:i!=null?(i/1e6).toFixed(2):""},p)})]}),R===n.name&&e.jsxs("tr",{className:"yoy-growth-row",children:[e.jsx("td",{style:{fontSize:"0.8em",textAlign:"right"},children:"YoY Growth"}),e.jsx("td",{}),c.slice(1).map((u,p)=>{try{const i=n[u]!==void 0?n[u]:"N/A",d=c[p],r=n[d]!==void 0?n[d]:"N/A";if(isNaN(i)||isNaN(r)||r===0)throw new Error("Invalid data for growth calculation");const f=(i/r-1).toFixed(2);return e.jsx("td",{className:`yoy-growth-value ${f>=0?"positive":"negative"}`,style:{textAlign:"center"},children:f},p)}catch(i){return console.error(`Error calculating YoY growth for ${u}:`,i.message),e.jsx("td",{className:"yoy-growth-value"},p)}})]})]},o))})]})})]})]})]},a)})})]})})]}):e.jsx("div",{children:e.jsx("h4",{children:"No item was selected"})})]})}export{ne as default};
