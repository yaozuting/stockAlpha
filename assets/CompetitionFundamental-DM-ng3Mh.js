import{r as w,j as n,R as I}from"./main-BCcnPGqQ.js";function P({data:k,stockCodes:A,competeDatas:C}){var M;const[E,R]=w.useState({}),[c,O]=w.useState(null),v=e=>{R(s=>({...s,[e]:!s[e]}))};w.useEffect(()=>{var S,u,p;console.log("child",k);const e=[(()=>{var a,x,m;const o=(a=k.income_statement)==null?void 0:a.map(i=>i.asOfDate).filter(Boolean),t=(x=o==null?void 0:o.sort((i,y)=>new Date(y)-new Date(i)))==null?void 0:x[0];return(m=k.income_statement)==null?void 0:m.find(i=>(i.periodType==="TTM"||i.periodType==="12M")&&i.asOfDate===t)})(),...Object.entries(C).map(([o,t])=>{var m,i,y;const a=(m=t==null?void 0:t.income_statement)==null?void 0:m.map(j=>j.asOfDate).filter(Boolean),x=(i=a==null?void 0:a.sort((j,N)=>new Date(N)-new Date(j)))==null?void 0:i[0];return(y=t==null?void 0:t.income_statement)==null?void 0:y.find(j=>(j.periodType==="TTM"||j.periodType==="12M")&&j.asOfDate===x)}).filter(Boolean)],s=[(S=k.balance_sheet_quarter)==null?void 0:S.at(-1),...Object.entries(C).map(([o,t])=>{var a;return(a=t==null?void 0:t.balance_sheet_quarter)==null?void 0:a.at(-1)}).filter(Boolean)],r=[(()=>{var a,x,m;const o=(a=k.cash_flow)==null?void 0:a.map(i=>i.asOfDate).filter(Boolean),t=(x=o==null?void 0:o.sort((i,y)=>new Date(y)-new Date(i)))==null?void 0:x[0];return(m=k.cash_flow)==null?void 0:m.find(i=>(i.periodType==="TTM"||i.periodType==="12M")&&i.asOfDate===t)})(),...Object.entries(C).map(([o,t])=>{var m,i,y;const a=(m=t==null?void 0:t.cash_flow)==null?void 0:m.map(j=>j.asOfDate).filter(Boolean),x=(i=a==null?void 0:a.sort((j,N)=>new Date(N)-new Date(j)))==null?void 0:i[0];return(y=t==null?void 0:t.cash_flow)==null?void 0:y.find(j=>(j.periodType==="TTM"||j.periodType==="12M")&&j.asOfDate===x)}).filter(Boolean)],l=[k.price.shortName,...Object.entries(C).map(([o,t])=>{var a;return(a=t==null?void 0:t.price)==null?void 0:a.shortName}).filter(Boolean)],f=[((u=k.summary_detail)==null?void 0:u.marketCap)??0,...Object.entries(C).map(([o,t])=>{var a;return((a=t==null?void 0:t.summary_detail)==null?void 0:a.marketCap)??0})],b=[((p=k.summary_profile)==null?void 0:p.sector)??"-",...Object.entries(C).map(([o,t])=>{var a;return((a=t==null?void 0:t.summary_profile)==null?void 0:a.sector)??"-"})],g=[(()=>{var t;const o=(t=k.summary_profile)==null?void 0:t.website;if(!o)return"-";try{const a=new URL(o);return{url:o,display:a.hostname.replace(/^www\./,"")}}catch{return"-"}})(),...Object.entries(C).map(([o,t])=>{var x;const a=(x=t==null?void 0:t.summary_profile)==null?void 0:x.website;if(!a)return"-";try{const m=new URL(a);return{url:a,display:m.hostname.replace(/^www\./,"")}}catch{return"-"}})],h=f.map((o,t)=>({stockName:l[t],marketCap:o,incomeStatement:e[t],balanceSheet:s[t],cashFlow:r[t],sector:b[t],website:g[t]}));h.sort((o,t)=>t.marketCap-o.marketCap),O(h)},[k,C]);const _=c==null?void 0:c.map(e=>{var p,o,t,a,x,m,i,y,j,N;const s=((p=e==null?void 0:e.incomeStatement)==null?void 0:p.TotalRevenue)??0,r=((o=e==null?void 0:e.incomeStatement)==null?void 0:o.GrossProfit)??0,l=((t=e==null?void 0:e.incomeStatement)==null?void 0:t.NetIncome)??0,f=((a=e==null?void 0:e.incomeStatement)==null?void 0:a.EBIT)??0,b=((x=e==null?void 0:e.incomeStatement)==null?void 0:x.PretaxIncome)??0,g=((m=e==null?void 0:e.cashFlow)==null?void 0:m.OperatingCashFlow)??0,h=((i=e==null?void 0:e.balanceSheet)==null?void 0:i.TotalAssets)??0,S=((y=e==null?void 0:e.balanceSheet)==null?void 0:y.TotalEquity)??((j=e==null?void 0:e.balanceSheet)==null?void 0:j.StockholdersEquity)??0,u=(((N=e==null?void 0:e.balanceSheet)==null?void 0:N.TotalDebt)??0)+(S||0);return{"Gross Margin (%)":s?r/s*100:null,"Operating Margin (%)":s?f/s*100:null,"Pretax Margin (%)":s?b/s*100:null,"Net Profit Margin (%)":s?l/s*100:null,"Cash Flow Margin (%)":s?g/s*100:null,"Return on Assets (ROA) (%)":h?l/h*100:null,"Return on Equity (ROE) (%)":S?l/S*100:null,"Return on Invested Capital (ROIC) (%)":u?l/u*100:null}}),F=c==null?void 0:c.map(e=>{var u,p,o,t,a,x,m,i,y,j;const s=((u=e==null?void 0:e.balanceSheet)==null?void 0:u.CurrentAssets)??0,r=((p=e==null?void 0:e.balanceSheet)==null?void 0:p.CurrentLiabilities)??0,l=((o=e==null?void 0:e.balanceSheet)==null?void 0:o.TotalAssets)??0;(t=e==null?void 0:e.balanceSheet)==null||t.TotalLiabilities;const f=((a=e==null?void 0:e.balanceSheet)==null?void 0:a.TotalEquity)??((x=e==null?void 0:e.balanceSheet)==null?void 0:x.StockholdersEquity)??0,b=((m=e==null?void 0:e.balanceSheet)==null?void 0:m.TotalDebt)??0,g=((i=e==null?void 0:e.balanceSheet)==null?void 0:i.Inventory)??0,h=((y=e==null?void 0:e.incomeStatement)==null?void 0:y.EBIT)??0,S=((j=e==null?void 0:e.incomeStatement)==null?void 0:j.InterestExpense)??0;return{"Current Ratio":r?s/r:null,"Quick Ratio":r?(s-g)/r:null,"Debt-to-Equity Ratio":f?b/f:null,"Debt-to-Assets Ratio":l?b/l:null,"Equity Ratio":l?f/l:null,"Asset Coverage Ratio":l?(l-g)/b:null,"Leverage Ratio":f?l/f:null,"Interest Coverage Ratio":S!==0?h/S:null}}),B=c==null?void 0:c.map(e=>{var p,o,t,a,x,m,i,y;const s=(e==null?void 0:e.marketCap)??0,r=((p=e==null?void 0:e.incomeStatement)==null?void 0:p.NetIncome)??0,l=((o=e==null?void 0:e.incomeStatement)==null?void 0:o.TotalRevenue)??0,f=((t=e==null?void 0:e.balanceSheet)==null?void 0:t.TotalEquity)??((a=e==null?void 0:e.balanceSheet)==null?void 0:a.StockholdersEquity)??0,b=((x=e==null?void 0:e.incomeStatement)==null?void 0:x.EBITDA)??0,g=((m=e==null?void 0:e.incomeStatement)==null?void 0:m.EBIT)??0,h=((i=e==null?void 0:e.balanceSheet)==null?void 0:i.TotalDebt)??0,S=((y=e==null?void 0:e.balanceSheet)==null?void 0:y.CashAndCashEquivalents)??0,u=s+h-S;return{"Price to Earnings (P/E)":r?s/r:null,"Price to Sales (P/S)":l?s/l:null,"Price to Book (P/B)":f?s/f:null,"EV/EBITDA":b?u/b:null,"EV/EBIT":g?u/g:null,"Earnings Yield (%)":s?r/s*100:null}}),T={"Income Statement":_,"Balance Sheet":F,Valuation:B};return n.jsx(n.Fragment,{children:n.jsxs("div",{className:"financials-wrapper",children:[n.jsx("div",{className:"financial-grid",children:n.jsxs("table",{className:"financial-table-fundamental",children:[n.jsx("thead",{children:n.jsxs("tr",{className:"sticky-header",children:[n.jsx("th",{children:"(MYR/Million)"}),c==null?void 0:c.map((e,s)=>n.jsx("th",{children:e.stockName},s)),n.jsx("th",{children:"Total"})]})}),n.jsxs("tbody",{children:[n.jsxs("tr",{children:[n.jsx("td",{children:"Sector"}),c==null?void 0:c.map((e,s)=>n.jsx("td",{children:e.sector||"-"},s)),n.jsx("td",{})]}),n.jsxs("tr",{children:[n.jsx("td",{children:"Website"}),c==null?void 0:c.map((e,s)=>n.jsx("td",{children:e.website.url?n.jsx("a",{href:e.website.url,target:"_blank",rel:"noopener noreferrer",children:"url"}):"-"},s)),n.jsx("td",{})]}),n.jsxs("tr",{className:"highlight-row",onClick:()=>v("marketCap"),children:[n.jsx("td",{children:"Market Cap (in Millions)"}),c==null?void 0:c.map((e,s)=>n.jsx("td",{children:e.marketCap?(e.marketCap/1e6).toLocaleString(void 0,{maximumFractionDigits:2}):"-"},s)),n.jsx("td",{className:"text-bold",children:((c==null?void 0:c.reduce((s,r)=>typeof r.marketCap=="number"?s+r.marketCap:s,0))/1e6).toLocaleString(void 0,{maximumFractionDigits:2})})]}),E.marketCap&&n.jsxs("tr",{className:"percentage-row",onClick:()=>v("marketCap"),children:[n.jsx("td",{children:"%"}),(()=>{const e=c==null?void 0:c.reduce((s,r)=>typeof r.marketCap=="number"?s+r.marketCap:s,0);return c==null?void 0:c.map((s,r)=>{const l=typeof s.marketCap=="number"&&e!==0?s.marketCap/e*100:0;return n.jsxs("td",{children:[l.toFixed(2),"%"]},r)})})(),n.jsx("td",{className:"text-bold",children:"100%"})]})]})]})}),T.Valuation&&n.jsxs("div",{className:"financial-grid",children:[n.jsx("h3",{className:"section-title",children:"Valuation Metrics"}),n.jsxs("table",{className:"financial-table-fundamental",children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{children:"Metric"}),c==null?void 0:c.map((e,s)=>n.jsx("th",{children:e.stockName},s)),n.jsx("th",{children:"Average"})]})}),n.jsx("tbody",{children:Object.keys(((M=T.Valuation)==null?void 0:M[0])||{}).map(e=>n.jsxs("tr",{children:[n.jsx("td",{className:"metric-label",children:e}),T.Valuation.map((s,r)=>n.jsx("td",{children:s[e]!=null?s[e].toFixed(2):"-"},r)),n.jsx("td",{className:"text-bold",children:(()=>{const s=T.Valuation.map(l=>l[e]).filter(l=>typeof l=="number"&&l>0),r=s.length?s.reduce((l,f)=>l+f,0)/s.length:null;return r!=null?`${r.toFixed(2)} (${s.length})`:"-"})()})]},e))})]})]}),["Income Statement","Balance Sheet","Cash Flow"].map(e=>{var s;return n.jsxs("div",{className:"financial-grid",children:[n.jsx("h2",{className:"section-title",children:e}),n.jsxs("table",{className:"financial-table-fundamental",children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{children:"(MYR/Million)"}),c==null?void 0:c.map((r,l)=>n.jsx("th",{children:r.stockName},l)),n.jsx("th",{children:"Total"})]})}),n.jsx("tbody",{children:(()=>{const r=e==="Income Statement"?c==null?void 0:c.map(h=>h.incomeStatement):e==="Balance Sheet"?c==null?void 0:c.map(h=>h.balanceSheet):c==null?void 0:c.map(h=>h.cashFlow),l=new Set;r==null||r.forEach(h=>Object.keys(h||{}).forEach(S=>l.add(S)));const f=["asOfDate","periodType"],b=Array.from(l).filter(h=>!f.includes(h));return[...f,...b.sort((h,S)=>{const u=r.reduce((o,t)=>o+(typeof(t==null?void 0:t[h])=="number"?t[h]:0),0);return r.reduce((o,t)=>o+(typeof(t==null?void 0:t[S])=="number"?t[S]:0),0)-u})].flatMap(h=>!r||r.length===0?(console.error("Dataset is undefined or empty."),[]):r.every(u=>{const p=u==null?void 0:u[h];return p==null||p==="-"||typeof p=="number"&&p===0})?[]:n.jsxs(I.Fragment,{children:[n.jsxs("tr",{onClick:()=>v(h),children:[n.jsx("td",{children:h.replace(/([a-z])([A-Z])/g,"$1 $2")}),r.map((u,p)=>{const o=u==null?void 0:u[h],t=typeof o=="number"?(o/1e6).toLocaleString(void 0,{maximumFractionDigits:2}):o??"-";return n.jsx("td",{children:t},p)}),n.jsx("td",{className:"text-bold",children:(()=>{const u=r.reduce((p,o)=>{const t=o==null?void 0:o[h];return typeof t=="number"?p+t:p},0);return u?(u/1e6).toLocaleString(void 0,{maximumFractionDigits:2}):"-"})()})]}),E[h]&&n.jsxs("tr",{className:"percentage-row",children:[n.jsx("td",{style:{textAlign:"right",fontFamily:"italic",fontSize:"0.8rem"},children:"%"}),r.map((u,p)=>{const o=u==null?void 0:u[h],t=r.reduce((x,m)=>{const i=m==null?void 0:m[h];return typeof i=="number"?x+i:x},0),a=typeof o=="number"&&t!==0?o/t*100:0;return n.jsxs("td",{style:{textAlign:"center",fontStyle:"italic",fontSize:"0.8em"},children:[a.toFixed(0),"%"]},p)}),n.jsx("td",{className:"text-bold",style:{textAlign:"center",fontStyle:"italic",fontSize:"0.8em"},children:"100%"})]})]},h))})()})]}),T[e]&&n.jsxs("div",{className:"financial-grid",children:[n.jsx("h3",{className:"section-title",children:e==="Income Statement"?"Profitability Metrics":e==="Balance Sheet"?"Leverage & Liquidity Ratios":"Metrics"}),n.jsxs("table",{className:"financial-table-fundamental",children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{children:"Metric"}),c==null?void 0:c.map((r,l)=>n.jsx("th",{children:r.stockName},l)),n.jsx("th",{children:"Average"})]})}),n.jsx("tbody",{children:Object.keys(((s=T[e])==null?void 0:s[0])||{}).map(r=>n.jsxs("tr",{children:[n.jsx("td",{className:"metric-label",children:r}),T[e].map((l,f)=>n.jsx("td",{children:l[r]!=null?e==="Income Statement"?l[r].toFixed(2)+"%":l[r].toFixed(2):"-"},f)),n.jsx("td",{className:"text-bold",children:(()=>{const l=T[e].map(b=>b[r]).filter(b=>typeof b=="number"&&b>0),f=l.length?l.reduce((b,g)=>b+g,0)/l.length:null;return f!=null?e==="Income Statement"?`${f.toFixed(2)}% (${l.length})`:`${f.toFixed(2)} (${l.length})`:"-"})()})]},r))})]})]})]},e)})]})})}export{P as default};
