import{r as v,j as t,R as B}from"./index-A_fZRioK.js";function P({data:w,stockCodes:A,competeDatas:k}){var M;const[E,R]=v.useState({}),[r,O]=v.useState(null),N=e=>{R(s=>({...s,[e]:!s[e]}))};v.useEffect(()=>{var u,f,j;console.log("child",w);const e=[(()=>{var l,m,p;const a=(l=w.income_statement)==null?void 0:l.map(h=>h.asOfDate).filter(Boolean),n=(m=a==null?void 0:a.sort((h,y)=>new Date(y)-new Date(h)))==null?void 0:m[0];return(p=w.income_statement)==null?void 0:p.find(h=>(h.periodType==="TTM"||h.periodType==="12M")&&h.asOfDate===n)})(),...Object.entries(k).map(([a,n])=>{var p,h,y;const l=(p=n==null?void 0:n.income_statement)==null?void 0:p.map(b=>b.asOfDate).filter(Boolean),m=(h=l==null?void 0:l.sort((b,T)=>new Date(T)-new Date(b)))==null?void 0:h[0];return(y=n==null?void 0:n.income_statement)==null?void 0:y.find(b=>(b.periodType==="TTM"||b.periodType==="12M")&&b.asOfDate===m)}).filter(Boolean)],s=[(u=w.balance_sheet_quarter)==null?void 0:u.at(-1),...Object.entries(k).map(([a,n])=>{var l;return(l=n==null?void 0:n.balance_sheet_quarter)==null?void 0:l.at(-1)}).filter(Boolean)],c=[(()=>{var l,m,p;const a=(l=w.cash_flow)==null?void 0:l.map(h=>h.asOfDate).filter(Boolean),n=(m=a==null?void 0:a.sort((h,y)=>new Date(y)-new Date(h)))==null?void 0:m[0];return(p=w.cash_flow)==null?void 0:p.find(h=>(h.periodType==="TTM"||h.periodType==="12M")&&h.asOfDate===n)})(),...Object.entries(k).map(([a,n])=>{var p,h,y;const l=(p=n==null?void 0:n.cash_flow)==null?void 0:p.map(b=>b.asOfDate).filter(Boolean),m=(h=l==null?void 0:l.sort((b,T)=>new Date(T)-new Date(b)))==null?void 0:h[0];return(y=n==null?void 0:n.cash_flow)==null?void 0:y.find(b=>(b.periodType==="TTM"||b.periodType==="12M")&&b.asOfDate===m)}).filter(Boolean)],o=[w.price.shortName,...Object.entries(k).map(([a,n])=>{var l;return(l=n==null?void 0:n.price)==null?void 0:l.shortName}).filter(Boolean)],x=[((f=w.summary_detail)==null?void 0:f.marketCap)??0,...Object.entries(k).map(([a,n])=>{var l;return((l=n==null?void 0:n.summary_detail)==null?void 0:l.marketCap)??0})],S=[((j=w.summary_profile)==null?void 0:j.sector)??"-",...Object.entries(k).map(([a,n])=>{var l;return((l=n==null?void 0:n.summary_profile)==null?void 0:l.sector)??"-"})],i=[(()=>{var n;const a=(n=w.summary_profile)==null?void 0:n.website;if(!a)return"-";try{const l=new URL(a);return{url:a,display:l.hostname.replace(/^www\./,"")}}catch{return"-"}})(),...Object.entries(k).map(([a,n])=>{var m;const l=(m=n==null?void 0:n.summary_profile)==null?void 0:m.website;if(!l)return"-";try{const p=new URL(l);return{url:l,display:p.hostname.replace(/^www\./,"")}}catch{return"-"}})],g=x.map((a,n)=>({stockName:o[n],marketCap:a,incomeStatement:e[n],balanceSheet:s[n],cashFlow:c[n],sector:S[n],website:i[n]}));g.sort((a,n)=>n.marketCap-a.marketCap),O(g)},[w,k]);const _=r==null?void 0:r.map(e=>{var j,a,n,l,m,p,h,y,b,T;const s=((j=e==null?void 0:e.incomeStatement)==null?void 0:j.TotalRevenue)??0,c=((a=e==null?void 0:e.incomeStatement)==null?void 0:a.GrossProfit)??0,o=((n=e==null?void 0:e.incomeStatement)==null?void 0:n.NetIncome)??0,x=((l=e==null?void 0:e.incomeStatement)==null?void 0:l.EBIT)??0,S=((m=e==null?void 0:e.incomeStatement)==null?void 0:m.PretaxIncome)??0,i=((p=e==null?void 0:e.cashFlow)==null?void 0:p.OperatingCashFlow)??0,g=((h=e==null?void 0:e.balanceSheet)==null?void 0:h.TotalAssets)??0,u=((y=e==null?void 0:e.balanceSheet)==null?void 0:y.TotalEquity)??((b=e==null?void 0:e.balanceSheet)==null?void 0:b.StockholdersEquity)??0,f=(((T=e==null?void 0:e.balanceSheet)==null?void 0:T.TotalDebt)??0)+(u||0);return{"Gross Margin (%)":s?c/s*100:null,"Operating Margin (%)":s?x/s*100:null,"Pretax Margin (%)":s?S/s*100:null,"Net Profit Margin (%)":s?o/s*100:null,"Cash Flow Margin (%)":s?i/s*100:null,"Return on Assets (ROA) (%)":g?o/g*100:null,"Return on Equity (ROE) (%)":u?o/u*100:null,"Return on Invested Capital (ROIC) (%)":f?o/f*100:null}}),F=r==null?void 0:r.map(e=>{var f,j,a,n,l,m,p,h,y,b;const s=((f=e==null?void 0:e.balanceSheet)==null?void 0:f.CurrentAssets)??0,c=((j=e==null?void 0:e.balanceSheet)==null?void 0:j.CurrentLiabilities)??0,o=((a=e==null?void 0:e.balanceSheet)==null?void 0:a.TotalAssets)??0;(n=e==null?void 0:e.balanceSheet)==null||n.TotalLiabilities;const x=((l=e==null?void 0:e.balanceSheet)==null?void 0:l.TotalEquity)??((m=e==null?void 0:e.balanceSheet)==null?void 0:m.StockholdersEquity)??0,S=((p=e==null?void 0:e.balanceSheet)==null?void 0:p.TotalDebt)??0,i=((h=e==null?void 0:e.balanceSheet)==null?void 0:h.Inventory)??0,g=((y=e==null?void 0:e.incomeStatement)==null?void 0:y.EBIT)??0,u=((b=e==null?void 0:e.incomeStatement)==null?void 0:b.InterestExpense)??0;return{"Current Ratio":c?s/c:null,"Quick Ratio":c?(s-i)/c:null,"Debt-to-Equity Ratio":x?S/x:null,"Debt-to-Assets Ratio":o?S/o:null,"Equity Ratio":o?x/o:null,"Asset Coverage Ratio":o?(o-i)/S:null,"Leverage Ratio":x?o/x:null,"Interest Coverage Ratio":u!==0?g/u:null}}),I=r==null?void 0:r.map(e=>{var j,a,n,l,m,p,h,y;const s=(e==null?void 0:e.marketCap)??0,c=((j=e==null?void 0:e.incomeStatement)==null?void 0:j.NetIncome)??0,o=((a=e==null?void 0:e.incomeStatement)==null?void 0:a.TotalRevenue)??0,x=((n=e==null?void 0:e.balanceSheet)==null?void 0:n.TotalEquity)??((l=e==null?void 0:e.balanceSheet)==null?void 0:l.StockholdersEquity)??0,S=((m=e==null?void 0:e.incomeStatement)==null?void 0:m.EBITDA)??0,i=((p=e==null?void 0:e.incomeStatement)==null?void 0:p.EBIT)??0,g=((h=e==null?void 0:e.balanceSheet)==null?void 0:h.TotalDebt)??0,u=((y=e==null?void 0:e.balanceSheet)==null?void 0:y.CashAndCashEquivalents)??0,f=s+g-u;return{"Price to Earnings (P/E)":c?s/c:null,"Price to Sales (P/S)":o?s/o:null,"Price to Book (P/B)":x?s/x:null,"EV/EBITDA":S?f/S:null,"EV/EBIT":i?f/i:null,"Earnings Yield (%)":s?c/s*100:null}}),C={"Income Statement":_,"Balance Sheet":F,Valuation:I};return t.jsx(t.Fragment,{children:t.jsxs("div",{className:"financials-wrapper",children:[t.jsx("div",{className:"financial-grid",children:t.jsxs("table",{className:"financial-table-fundamental",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"sticky-header",children:[t.jsx("th",{children:"(MYR/Million)"}),r==null?void 0:r.map((e,s)=>t.jsx("th",{children:e.stockName},s)),t.jsx("th",{children:"Total"})]})}),t.jsxs("tbody",{children:[t.jsxs("tr",{children:[t.jsx("td",{children:"Sector"}),r==null?void 0:r.map((e,s)=>t.jsx("td",{children:e.sector||"-"},s)),t.jsx("td",{})]}),t.jsxs("tr",{children:[t.jsx("td",{children:"Website"}),r==null?void 0:r.map((e,s)=>t.jsx("td",{children:e.website.url?t.jsx("a",{href:e.website.url,target:"_blank",rel:"noopener noreferrer",children:"url"}):"-"},s)),t.jsx("td",{})]}),t.jsxs("tr",{className:"highlight-row",onClick:()=>N("marketCap"),children:[t.jsx("td",{children:"Market Cap (in Millions)"}),r==null?void 0:r.map((e,s)=>t.jsx("td",{children:e.marketCap?(e.marketCap/1e6).toLocaleString(void 0,{maximumFractionDigits:2}):"-"},s)),t.jsx("td",{className:"text-bold",children:((r==null?void 0:r.reduce((s,c)=>typeof c.marketCap=="number"?s+c.marketCap:s,0))/1e6).toLocaleString(void 0,{maximumFractionDigits:2})})]}),E.marketCap&&t.jsxs("tr",{className:"percentage-row",onClick:()=>N("marketCap"),children:[t.jsx("td",{children:"%"}),(()=>{const e=r==null?void 0:r.reduce((s,c)=>typeof c.marketCap=="number"?s+c.marketCap:s,0);return r==null?void 0:r.map((s,c)=>{const o=typeof s.marketCap=="number"&&e!==0?s.marketCap/e*100:0;return t.jsxs("td",{children:[o.toFixed(2),"%"]},c)})})(),t.jsx("td",{className:"text-bold",children:"100%"})]})]})]})}),C.Valuation&&t.jsxs("div",{className:"financial-grid",children:[t.jsx("h3",{className:"section-title",children:"Valuation Metrics"}),t.jsxs("table",{className:"financial-table-fundamental",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"Metric"}),r==null?void 0:r.map((e,s)=>t.jsx("th",{children:e.stockName},s)),t.jsx("th",{children:"Average"})]})}),t.jsx("tbody",{children:Object.keys(((M=C.Valuation)==null?void 0:M[0])||{}).map(e=>t.jsxs("tr",{children:[t.jsx("td",{className:"metric-label",children:e}),C.Valuation.map((s,c)=>t.jsx("td",{children:s[e]!=null?s[e].toFixed(2):"-"},c)),t.jsx("td",{className:"text-bold",children:(()=>{const s=C.Valuation.map(o=>o[e]).filter(o=>typeof o=="number"&&o>0),c=s.length?s.reduce((o,x)=>o+x,0)/s.length:null;return c!=null?`${c.toFixed(2)} (${s.length})`:"-"})()})]},e))})]})]}),["Income Statement","Balance Sheet","Cash Flow"].map(e=>{var s;return t.jsxs("div",{className:"financial-grid",children:[t.jsx("h2",{className:"section-title",children:e}),t.jsxs("table",{className:"financial-table-fundamental",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"(MYR/Million)"}),r==null?void 0:r.map((c,o)=>t.jsx("th",{children:c.stockName},o)),t.jsx("th",{children:"Total"})]})}),t.jsx("tbody",{children:(()=>{const c=e==="Income Statement"?r==null?void 0:r.map(i=>i.incomeStatement):e==="Balance Sheet"?r==null?void 0:r.map(i=>i.balanceSheet):r==null?void 0:r.map(i=>i.cashFlow),o=new Set;c==null||c.forEach(i=>Object.keys(i||{}).forEach(g=>o.add(g)));const x=["asOfDate","periodType"];return[...x,...Array.from(o).filter(i=>!x.includes(i)).sort()].flatMap(i=>!c||c.length===0?(console.error("Dataset is undefined or empty."),[]):c.every(u=>{const f=u==null?void 0:u[i];return f==null||f==="-"||typeof f=="number"&&f===0})?[]:t.jsxs(B.Fragment,{children:[t.jsxs("tr",{onClick:()=>N(i),children:[t.jsx("td",{children:i.replace(/([a-z])([A-Z])/g,"$1 $2")}),c.map((u,f)=>{const j=u==null?void 0:u[i],a=typeof j=="number"?(j/1e6).toLocaleString(void 0,{maximumFractionDigits:2}):j??"-";return t.jsx("td",{children:a},f)}),t.jsx("td",{className:"text-bold",children:(()=>{const u=c.reduce((f,j)=>{const a=j==null?void 0:j[i];return typeof a=="number"?f+a:f},0);return u?(u/1e6).toLocaleString(void 0,{maximumFractionDigits:2}):"-"})()})]}),E[i]&&t.jsxs("tr",{className:"percentage-row",children:[t.jsx("td",{style:{textAlign:"right",fontFamily:"italic",fontSize:"0.8rem"},children:"%"}),c.map((u,f)=>{const j=u==null?void 0:u[i],a=c.reduce((l,m)=>{const p=m==null?void 0:m[i];return typeof p=="number"?l+p:l},0),n=typeof j=="number"&&a!==0?j/a*100:0;return t.jsxs("td",{style:{textAlign:"center",fontStyle:"italic",fontSize:"0.8em"},children:[n.toFixed(0),"%"]},f)}),t.jsx("td",{className:"text-bold",style:{textAlign:"center",fontStyle:"italic",fontSize:"0.8em"},children:"100%"})]})]},i))})()})]}),C[e]&&t.jsxs("div",{className:"financial-grid",children:[t.jsx("h3",{className:"section-title",children:e==="Income Statement"?"Profitability Metrics":e==="Balance Sheet"?"Leverage & Liquidity Ratios":"Metrics"}),t.jsxs("table",{className:"financial-table-fundamental",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{children:"Metric"}),r==null?void 0:r.map((c,o)=>t.jsx("th",{children:c.stockName},o)),t.jsx("th",{children:"Average"})]})}),t.jsx("tbody",{children:Object.keys(((s=C[e])==null?void 0:s[0])||{}).map(c=>t.jsxs("tr",{children:[t.jsx("td",{className:"metric-label",children:c}),C[e].map((o,x)=>t.jsx("td",{children:o[c]!=null?e==="Income Statement"?o[c].toFixed(2)+"%":o[c].toFixed(2):"-"},x)),t.jsx("td",{className:"text-bold",children:(()=>{const o=C[e].map(S=>S[c]).filter(S=>typeof S=="number"&&S>0),x=o.length?o.reduce((S,i)=>S+i,0)/o.length:null;return x!=null?e==="Income Statement"?`${x.toFixed(2)}% (${o.length})`:`${x.toFixed(2)} (${o.length})`:"-"})()})]},c))})]})]})]},e)})]})})}export{P as default};
